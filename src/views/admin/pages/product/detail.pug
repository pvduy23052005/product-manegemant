extends ../../layout/layoutDefault.pug
include ../../mixins/header-menu.pug

block main 
  +header-menu(`Chi tiết sản phẩm`, "")
  - var formatDate = function(date) {  if(!date) return ''; return new Date(date).toLocaleString('vi-VN');}

  .container.mt-4
    //- PHẦN 1: THÔNG TIN CƠ BẢN
    .card.mb-4
      .card-body
        .row
          //- Cột trái: Ảnh sản phẩm
          .col-md-4
            div.d-flex.justify-content-center.align-items-center.h-100.border.rounded.p-3.bg-light
              img.img-fluid(
                src=product.thumbnail
                alt=product.title
                style="max-height: 300px; object-fit: contain;"
              )

          //- Cột phải: Thông tin chi tiết
          .col-md-8
            h3.mb-3.text-uppercase.fw-bold= product.title

            table.table.table-striped.table-hover
              tbody
                tr
                  td.fw-bold(style="width: 150px") Trạng thái:
                  td
                    if product.status === 'active'
                      span.badge.bg-success Hoạt động
                    else
                      span.badge.bg-danger Ngừng hoạt động
                tr
                  td.fw-bold Giá bán:
                  td.fw-bold.text-success.fs-5= product.price.toLocaleString('vi-VN') + ' đ'
                tr
                  td.fw-bold Giảm giá:
                  td
                    span.badge.bg-warning.text-dark= `-${product.discountPercentage}%`
                tr
                  td.fw-bold Tồn kho:
                  td= product.stock + ' sản phẩm'
                tr
                  td.fw-bold Vị trí:
                  td= product.position

            .d-flex.mt-4.gap-2
              a.btn.btn-warning(href=`/admin/product/edit/${product._id}`) 
                i.fa-solid.fa-pen-to-square.me-2
                | Chỉnh sửa
              a.btn.btn-secondary(href="/admin/product") 
                i.fa-solid.fa-arrow-left.me-2
                | Quay lại

    //- PHẦN 2: MÔ TẢ SẢN PHẨM
    .card.mb-4
      .card-header.bg-primary.text-white.fw-bold
        i.fa-solid.fa-circle-info.me-2
        | Mô tả sản phẩm
      .card-body
        if product.description
          div(class="product-description")!= product.description
        else 
          p.text-muted.fst-italic Chưa có mô tả.

    .card
      .card-header.bg-info.text-white.fw-bold
        i.fa-solid.fa-clock-rotate-left.me-2
        | Lịch sử hành động
      .card-body
        .row 
          .col-md-6
            h6.text-primary.fw-bold Người tạo
            if product.createdBy && product.createdBy.account_id
              ul.list-group.list-group-flush
                li.list-group-item
                  strong Họ tên: 
                  | #{product.createdBy.account_id.fullName}
                li.list-group-item
                  strong Email: 
                  | #{product.createdBy.account_id.email}
                li.list-group-item
                  strong Thời gian: 
                  | #{formatDate(product.createdBy.createdAt)}
            else 
              p.text-muted Không có thông tin người tạo.


          .col-md-6
            h6.text-primary.fw-bold Lịch sử cập nhật
            if product.updatedBy && product.updatedBy.length > 0
              div(style="max-height: 200px; overflow-y: auto;")
                ul.list-group
                  each item in product.updatedBy.slice().reverse()
                    li.list-group-item.d-flex.justify-content-between.align-items-center
                      div
                        if item.account_id
                          strong= item.account_id.fullName
                        else 
                          em.text-muted (Tài khoản đã xóa)
                        br
                        small.text-muted= formatDate(item.updatedTime)
                      span.badge.rounded-pill.bg-secondary Sửa
            else
              p.text-muted Chưa có chỉnh sửa nào.